function SearchBox(){"use strict";function n(a){return d.querySelector("[data-id="+a+"]")}function o(){return"none"!==n("replaceNext").style.display}function p(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;void 0===a&&(a=!o()),n("replaceDiv").style.display=a?"block":"none",n("toggleReplace").innerHTML=a?"F":"R",n("toggleReplace").title=a?"Find (ctrl+F)":"Replace (ctrl+R)",n("optToggler1").style.display=n("replaceNext").style.display=n("replacePrev").style.display=n("replaceAll").style.display=a?"inline":"none",n("optToggler2").style.display=a?"none":"inline"}function q(a){var b=void 0;return a instanceof Element&&a.dataset&&a.dataset.id?b=a:"string"==typeof a&&h.forEach(function(c){c.dataset.id==a&&(b=c)}),{btn:b,id:b?b.dataset.id:void 0}}function r(a){var b=q(a),c=b.btn;return!!c&&"inset"===c.style.borderStyle}function s(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,d=q(a),e=d.btn,f=d.id;return e?(void 0===b&&(b=!r(e)),b=!!b,e.style.borderStyle=b?"inset":"outset",c[f]=b,b):null}function t(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,c=q(a),d=c.btn;return d?(void 0===b&&(b=!d.disabled),b=!!b,d.disabled=b,b):null}function u(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,b=String.fromCharCode(9650),c=String.fromCharCode(9660),d=n("optBtnsDiv");void 0===a&&(a=!("inline"===d.style.display)),n("optToggler1").innerHTML=n("optToggler2").innerHTML=a?b:c,d.style.display=a?"inline":"none",e.focus()}function v(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(y()||a){var c=b.getBoundingClientRect(),e=d.getBoundingClientRect();d.style.top="-"+c.height+"px",d.style.left=c.width-e.width-9+"px"}}function w(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;p(a),v(!0),void 0!==b&&(e.value=b),B(!0),e.focus()}function x(){d.style.top=d.style.left="-10000px"}function y(){return parseFloat(d.style.top)!==-1e4}function z(){e.focus()}function A(){e.focus();var a=n("scombo");a.style.borderColor="red",e.getInputElement().style.color="red",setTimeout(function(){a.style.borderColor="black",e.getInputElement().style.color=""},500)}function B(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.select(a),f.select(a)}function C(a){var b=d.getBoundingClientRect();return!(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom)}function D(){n("close").onclick=function(b){b.stopPropagation(),x(),a.focus()},e.onchange=f.onchange=function(a,b){i&&i(b===e?"next":"replaceNext")},e.onkeydown=f.onkeydown=function(a,b){var c=void 0;if(k&&(c=k(a,b===e)),c!==!1&&!a.defaultPrevented){var d=!a.shiftKey&&!a.ctrlKey&&!a.altKey,g=!a.shiftKey&&a.ctrlKey&&!a.altKey,h=a.shiftKey&&a.ctrlKey&&!a.altKey;g&&"f"===a.key&&o()?(p(!1),e.focus()):g&&"h"===a.key&&!o()?(p(!0),e.value?f.focus():e.focus()):d&&"Tab"===a.key&&(b===e&&o()?f.focus():n("next").focus()),(d&&["F3","Tab"].indexOf(a.key)>-1||g&&["f","h","g","F","H","G"].indexOf(a.key)>-1||h&&["g","G"].indexOf(a.key)>-1)&&a.preventDefault()}},e.oninput=f.oninput=function(a,b){l&&l(a,b===e)};var b=function(b){if(b.stopPropagation(),e.focus(),i){var c=b.currentTarget.dataset.id;i(c)}},c=function(b){var c=!b.shiftKey&&!b.ctrlKey&&!b.altKey&&"Tab"===b.key,d=!b.shiftKey&&!b.ctrlKey&&!b.altKey&&"Escape"===b.key;if(c){b.stopPropagation(),b.preventDefault();var f=n(o()?"replaceAll":"prev"),h=g.indexOf(b.currentTarget);b.currentTarget===f?e.focus():g[h+1].focus()}else d&&x()};g.forEach(function(a){a.onclick=b,a.onkeydown=c}),n("toggleReplace").onclick=function(a){p()};var q=function(b){b.stopPropagation();var c=b.currentTarget,d=c.dataset.id,f=s(c);"regex"===d&&t("wholeWord",f),e.focus(),j&&j(d)};h.forEach(function(a){a.onclick=q}),n("optToggler1").onclick=n("optToggler2").onclick=function(a){u()},d.onclick=function(a){a.stopPropagation(),e.focus()},e.onblur=f.onblur=function(a){if(m){var b=a.relatedTarget?a.relatedTarget:document.activeElement;d.contains(b)||m(a)}}}function E(i,j){a=i,b=a.getWrapperElement(),c=j;var k='\n\t\t\t\t<div class="cmsearchBox">\n\t\t\t\t\t<button data-id="close" class="cmsearchCloseBtn" title="Close (Escape)">X</button>\n\t\t\t\t\t<div data-id="searchDiv">\n\t\t\t\t\t\t<div data-id="scombo" class="cmsearchCombo"></div>\n\t\t\t\t\t\t<button data-id="toggleReplace" class="cmsearchFloatedSmallBtns"></button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div data-id="replaceDiv" style="clear:both;">\n\t\t\t\t\t\t<div data-id="rcombo" class="cmsearchCombo"></div>\n\t\t\t\t\t\t<button data-id="optToggler1" class="cmsearchFloatedSmallBtns" title="settings">&#9660;</button> \n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="float:left; ">\n\t\t\t\t\t\t<button data-id="next" class="cmsearchBigBtns" title="Find Next (F3)">&rarr;</button>\n\t\t\t\t\t\t<button data-id="prev" class="cmsearchBigBtns" title="Find Previous (F4)">&larr;</button>\n\t\t\t\t\t\t<button data-id="replaceNext" class="cmsearchBigBtns" title="Replace Next">&#x21D2;</button>\n\t\t\t\t\t\t<button data-id="replacePrev" class="cmsearchBigBtns" title="Replace Previous">&#x21D0;</button>\n\t\t\t\t\t\t<button data-id="replaceAll" class="cmsearchBigBtns" style="margin-right:0px;" title="Replace All">&#x21D4;</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="float:right;">\n\t\t\t\t\t\t<button data-id="optToggler2" class="cmsearchSmallBtns" title="settings" style="margin-top:3px;margin-right:1px">&#9660;</button> \n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="clear:both; min-height: 5px"></div>\n\t\t\t\t\t<div data-id="optBtnsDiv" style="float:right;margin-top:7px;margin-right:1px;display:none;">\n\t\t\t\t\t\t<button data-id="caseSensitive" class="cmsearchSmallBtns" title="Case Sensitive">C</button>\n\t\t\t\t\t\t<button data-id="wholeWord" class="cmsearchSmallBtns" title="Whole Word">W</button>\n\t\t\t\t\t\t<button data-id="regex" class="cmsearchSmallBtns" title="Regular Expression">R</button>\n\t\t\t\t\t\t<button data-id="inSelection" class="cmsearchSmallBtns" title="In Selection">S</button>\n\t\t\t\t\t\t<button data-id="wrapAround" class="cmsearchSmallBtns" title="Wrap Around">A</button>\n\t\t\t\t\t\t<button data-id="highlight" class="cmsearchSmallBtns" title="Highlight">H</button>\n\t\t\t\t\t\t<button data-id="persistent" class="cmsearchSmallBtns" title="Persistent Dialog">P</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>';d=document.createElement("div"),b.appendChild(d);var l=[].slice.call(b.children).indexOf(d);d.outerHTML=k,d=b.children[l];var m=window.getComputedStyle(b,null).getPropertyValue("background-color");m=m.replace(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/,"rgba($1,$2,$2,0.8)"),d.style.backgroundColor=m,e=Combo.New(n("scombo")),f=Combo.New(n("rcombo")),g=[n("next"),n("prev"),n("replaceNext"),n("replacePrev"),n("replaceAll")],h=[n("caseSensitive"),n("wholeWord"),n("regex"),n("inSelection"),n("wrapAround"),n("highlight"),n("persistent")],Object.keys(c).forEach(function(a){return s(a,c[a])}),D(),x()}var a=void 0,b=void 0,c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0;return{ctor:E,show:w,hide:x,visible:y,position:v,focus:z,notFound:A,overlaps:C,get value(){return[e.value,f.value]},set onchange(a){i=a},set onoptchange(a){j=a},set onkeydown(a){k=a},set oninput(a){l=a},set onblur(a){m=a}}}function CMsearch(){"use strict";function g(a,b){return a.line<b.line||a.line===b.line&&a.ch<b.ch}function h(a,b){return a.line>b.line||a.line===b.line&&a.ch>b.ch}function i(a,b){return a.line===b.line&&a.ch===b.ch}function j(){return{line:0,ch:0}}function k(a){for(var b=a.lineCount()-1,c=a.getLine(b).trim().length;b>0&&0===c;)b--,c=a.getLine(b).trim().length;return{line:b,ch:c}}function l(){var b=a.listSelections();if(0===b.length)return null;var c={from:b[0].anchor,to:b[0].head};return h(c.from,c.to)&&(c={from:c.to,to:c.from}),c}function m(a,b,c){var d=new RegExp("(?:^|\\s)"+b+"(?!\\S)","g"),e=arguments.length>2?c:null===a.className.match(d);a.className=a.className.replace(d,""),e&&(a.className+=" "+b)}function n(a,b,c){m(a.getWrapperElement().getElementsByClassName("CodeMirror-cursors")[0],b,c)}function o(a,b,c){var d=Array.from(a.getWrapperElement().getElementsByClassName("CodeMirror-cursor"));d.forEach(function(a){m(a,b,c)})}function p(a){var b=a.replace(/.*\/([gimuy]*)$/,"$1");b===a&&(b="");var c=b?a.replace(new RegExp("^/(.*?)/"+b+"$"),"$1"):a;b.replace("g","");try{return new RegExp(c,b)}catch(a){return null}}function q(){e&&(e.clear(),e=null)}function r(){var a=c.value[0],d=void 0;return a?(b.regex?d=p(a):(a=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),a&&b.wholeWord&&(a="\\b"+a+"\\b"),d=new RegExp(a)),d&&(d=new RegExp(d.source,b.caseSensitive?"":"i")),d):null}function s(){var b=r();d=b&&c.value[0].length>1?new RegExp(b.source,b.flags+"g"):null,d&&(d.lastIndex=0),a.setOption("maxHighlightLength",--a.options.maxHighlightLength+1)}function t(){d=null,a.setOption("maxHighlightLength",--a.options.maxHighlightLength+1)}function u(){var a=l();return b.inSelection&&a&&f&&i(f.from,a.from)&&i(f.to,a.to)}function v(){if(!b.inSelection)return{from:j(),to:k(a)};var c=l(),d={from:{line:0,ch:0},to:{line:0,ch:0}};return!c||u()?d:c}function w(){o(a,"redCursor",!0),setTimeout(function(){o(a,"redCursor",!1)},500),C()?c.notFound():a.focus()}function x(){var d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],j=r();if(!j)return w(),!1;var k=v(),l=void 0;b.inSelection?l=f?d?f.to:f.from:k.from:(l=a.getCursor(),f&&!d&&i(l,f.to)&&(l=f.from));var m=a.getSearchCursor(j,l),n=m.find(!d);return n&&b.inSelection&&(g(m.from(),k.from)||h(m.to(),k.to))&&(n=null),!n&&b.wrapAround&&(l=d?k.from:k.to,m=a.getSearchCursor(j,l),n=m.find(!d),n&&b.inSelection&&(g(m.from(),k.from)||h(m.to(),k.to))&&(n=null)),n?(s(),b.persistent||(c.hide(),a.focus()),f={from:m.from(),to:m.to()},a.scrollIntoView(f,20),b.inSelection||a.setSelection(m.from(),m.to()),q(),e=a.markText(f.from,f.to,{className:"cm-searchMatch"}),setTimeout(function(){for(var b=a.getWrapperElement().getElementsByClassName("cm-searchMatch")[0];c.overlaps(b.getBoundingClientRect());){var d=a.getScrollInfo().top;if(d<25)break;a.scrollTo(null,d-25)}},0),!0):(w(),!1)}function y(){var d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!f)return x(d);var g=r(),h=c.value[1]||"";return g?(b.regex&&!function(){var b=a.getRange(f.from,f.to).match(g);h=h.replace(/\$(\d)/g,function(a,c){return b[c]})}(),a.replaceRange(h,f.from,f.to),q(),e=a.markText(f.from,f.to,{className:"cm-searchMatch"}),void x(d)):void w()}function z(){var d=r(),e=c.value[1];if(!d||!e)return void w();var f=v(),g=0;a.operation(function(){for(var c=a.getSearchCursor(d,f.from);c.findNext()&&(!b.inSelection||!h(c.to(),f.to));)b.regex?!function(){var b=a.getRange(c.from(),c.to()).match(d);c.replace(e.replace(/\$(\d)/g,function(a,c){return b[c]}))}():c.replace(e),g++}),0===g?w():b.persistent||(c.hide(),a.focus()),q()}function A(){var d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=a.getSelection(),f=void 0;!b.inSelection&&e.length>1&&e.length<100&&(f=e,q()),c.show(d,f),s()}function B(a){b.persistent&&!a||(c.hide(),t())}function C(){return c.visible()}function D(){c.onchange=function(a){s(),"next"===a?x():"prev"===a?x(!1):"replaceNext"===a?y():"replacePrev"===a?y(!1):"replaceAll"===a&&z()},c.onoptchange=function(b){"inSelection"===b&&u()&&a.setSelection(a.getCursor()),q(),s()},c.onkeydown=function(b,c){"Escape"===b.key&&(B(!0),a.focus())},c.oninput=function(a,b){b&&s()},c.onblur=function(){B()},a.on("beforeSelectionChange",function(a,b){b.origin&&(f=null)}),a.on("change",function(a,b){b.origin&&(C()||t(),f=null)}),a.on("refresh",function(a){c.position()}),a.on("blur",function(a){n(a,"CodeMirror-cursorsVisible",!0)}),a.on("focus",function(a){q(),n(a,"CodeMirror-cursorsVisible",!1)})}function E(e){a=e,b={caseSensitive:!1,wholeWord:!1,regex:!1,wrapAround:!1,highlight:!0,inSelection:!1,persistent:!0},c=SearchBox.New(a,b),a.addOverlay({token:function(c){if(!d||!b.highlight)return void c.skipToEnd();d.lastIndex=c.pos;var e=d.exec(c.string);return e&&e.index==c.pos?(c.pos+=e[0].length||1,b.inSelection?"inSelectionSearchHighlight":"searchHighlight"):void(e?c.pos=e.index:c.skipToEnd())}}),a.focus(),D()}var a=void 0,b=void 0,c=void 0,d=void 0,e=void 0,f=void 0;return{ctor:E,show:A,hide:B,visible:C,find:x,replace:y,replaceAll:z}}function initCMsearch(a){"use strict";a.cmsearch=CMsearch.New(a),a.addKeyMap({"Ctrl-F":function(b){return b.cmsearch.show()},"Ctrl-G":function(b){return b.cmsearch.find()},F3:function(b){return b.cmsearch.find()},"Shift-Ctrl-G":function(b){return b.cmsearch.find(!1)},"Shift-F3":function(b){return b.cmsearch.find(!1)},"Shift-Ctrl-F":function(b){return b.cmsearch.show(!0)},"Ctrl-H":function(b){return b.cmsearch.show(!0)},"Ctrl-F3":function(b){return b.cmsearch.replace()},"Shift-Ctrl-H":function(b){return b.cmsearch.replace()},"Shift-Ctrl-F3":function(b){return b.cmsearch.replace(!1)},"Shift-Ctrl-R":function(b){return b.cmsearch.ReplaceAll()},Esc:function(b){return b.cmsearch.hide(!0)}})}
