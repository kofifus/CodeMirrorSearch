function SearchBox(){"use strict";function n(a){return d.querySelector("[data-id="+a+"]")}function o(){return"none"!==n("replaceNext").style.display}function p(){var a=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0];void 0===a&&(a=!o()),f.toggle(a),n("replaceNext").style.display=n("replacePrev").style.display=n("replaceAll").style.display=a?"inline":"none"}function q(a){var b=void 0;return a instanceof Element&&a.dataset&&a.dataset.id?b=a:"string"==typeof a&&h.forEach(function(c){c.dataset.id==a&&(b=c)}),{btn:b,id:b?b.dataset.id:void 0}}function r(a){var b=q(a),c=b.btn;b.id;return!!c&&"inset"===c.style.borderStyle}function s(a){var b=arguments.length<=1||void 0===arguments[1]?void 0:arguments[1],d=q(a),e=d.btn,f=d.id;return e?(void 0===b&&(b=!r(e)),b=!!b,e.style.borderStyle=b?"inset":"outset",c[f]=b,b):null}function t(a){var b=arguments.length<=1||void 0===arguments[1]?void 0:arguments[1],c=q(a),d=c.btn;c.id;return d?(void 0===b&&(b=!d.disabled),b=!!b,d.disabled=b,b):null}function u(){var a=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0],b=String.fromCharCode(9650),c=String.fromCharCode(9660),d=n("optBtnsDiv");void 0===a&&(a=!("inline"===d.style.display)),n("optToggler").innerHTML=a?b:c,d.style.display=a?"inline":"none",e.focus()}function v(){var a=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];if(y()||a){var c=b.getBoundingClientRect(),e=d.getBoundingClientRect();d.style.top="-"+c.height+"px",d.style.left=c.width-e.width-9+"px"}}function w(){var a=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],b=arguments.length<=1||void 0===arguments[1]?void 0:arguments[1];p(a),v(!0),void 0!==b&&(e.value=b),B(!0),e.focus()}function x(){d.style.top=d.style.left="-10000px"}function y(){return parseFloat(d.style.top)!==-1e4}function z(){e.focus()}function A(){e.focus();var a=n("scombo");a.style.borderColor="red",e.getInputElement().style.color="red",setTimeout(function(){a.style.borderColor="black",e.getInputElement().style.color=""},500)}function B(){var a=arguments.length<=0||void 0===arguments[0]||arguments[0];e.select(a),f.select(a)}function C(a){var b=d.getBoundingClientRect();return!(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom)}function D(){e.onchange=f.onchange=function(a,b){i&&i(b===e?"next":"replaceNext")},e.onkeydown=f.onkeydown=function(a,b){var c=void 0;if(k&&(c=k(a,b===e)),c!==!1&&!a.defaultPrevented){var d=!a.shiftKey&&!a.ctrlKey&&!a.altKey,g=!a.shiftKey&&a.ctrlKey&&!a.altKey,h=a.shiftKey&&a.ctrlKey&&!a.altKey;g&&"f"===a.key&&o()?(p(!1),e.focus()):g&&"h"===a.key&&!o()?(p(!0),e.value?f.focus():e.focus()):d&&"Tab"===a.key&&(b===e&&o()?f.focus():n("next").focus()),(d&&["F3","Tab"].indexOf(a.key)>-1||g&&["f","h","g","F","H","G"].indexOf(a.key)>-1||h&&["g","G"].indexOf(a.key)>-1)&&a.preventDefault()}},e.oninput=f.oninput=function(a,b){l&&l(a,b===e)};var a=function(b){if(b.stopPropagation(),e.focus(),i){var c=b.currentTarget.dataset.id;i(c)}},b=function(b){var c=!b.shiftKey&&!b.ctrlKey&&!b.altKey&&"Tab"===b.key,d=!b.shiftKey&&!b.ctrlKey&&!b.altKey&&"Escape"===b.key;if(c){b.stopPropagation(),b.preventDefault();var f=n(o()?"replaceAll":"prev"),h=g.indexOf(b.currentTarget);b.currentTarget===f?e.focus():g[h+1].focus()}else d&&x()};g.forEach(function(c){c.onclick=a,c.onkeydown=b});var c=function(b){b.stopPropagation();var c=b.currentTarget,d=c.dataset.id,f=s(c);"regex"===d&&t("wholeWord",f),e.focus(),j&&j(d)};h.forEach(function(a){a.onclick=c}),n("optToggler").onclick=function(a){u()},d.onclick=function(a){a.stopPropagation(),e.focus()},e.onblur=f.onblur=function(a){if(m){a.relatedTarget?a.relatedTarget:document.activeElement;d.contains(a.relatedTarget)||m(a)}}}function E(i,j){a=this,b=i,c=j;var k='\n\t\t\t\t<div class="cmsearchBox">\n\t\t\t\t\t<div data-id="scombo" class="cmsearchCombo"></div>\n\t\t\t\t\t<div data-id="rcombo" class="cmsearchCombo" style="margin-top:7px;"></div>\n\t\t\t\t\t<div style="min-height: 9px"></div>\n\t\t\t\t\t<div style="float:left; ">\n\t\t\t\t\t\t<button data-id="next" class="cmsearchBigBtns" title="Find Next (F3)">&rarr;</button>\n\t\t\t\t\t\t<button data-id="prev" class="cmsearchBigBtns" title="Find Previous (F4)">&larr;</button>\n\t\t\t\t\t\t<button data-id="replaceNext" class="cmsearchBigBtns" title="Replace Next">&#x21D2;</button>\n\t\t\t\t\t\t<button data-id="replacePrev" class="cmsearchBigBtns" title="Replace Previous">&#x21D0;</button>\n\t\t\t\t\t\t<button data-id="replaceAll" class="cmsearchBigBtns" title="Replace All">&#x21D4;</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="float:right">\n\t\t\t\t\t\t<button data-id="optToggler" class="cmsearchSmallBtns" title="settings" style="margin-top:4px;margin-right:1px">&#9660;</button> \n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="clear:both"></div>\n\t\t\t\t\t<div data-id="optBtnsDiv" style="float:right;margin-top:7px;margin-right:1px;display:none;">\n\t\t\t\t\t\t<button data-id="caseSensitive" class="cmsearchSmallBtns" title="Case Sensitive">C</button>\n\t\t\t\t\t\t<button data-id="wholeWord" class="cmsearchSmallBtns" title="Whole Word">W</button>\n\t\t\t\t\t\t<button data-id="regex" class="cmsearchSmallBtns" title="Regular Expression">R</button>\n\t\t\t\t\t\t<button data-id="inSelection" class="cmsearchSmallBtns" title="In Selection">S</button>\n\t\t\t\t\t\t<button data-id="wrapAround" class="cmsearchSmallBtns" title="Wrap Around">A</button>\n\t\t\t\t\t\t<button data-id="highlight" class="cmsearchSmallBtns" title="Highlight">H</button>\n\t\t\t\t\t\t<button data-id="persistent" class="cmsearchSmallBtns" title="Persistent Dialog">P</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>';d=document.createElement("div"),b.appendChild(d);var l=[].slice.call(b.children).indexOf(d);d.outerHTML=k,d=b.children[l];var m=window.getComputedStyle(b,null).getPropertyValue("background-color");m=m.replace(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/,"rgba($1,$2,$2,0.8)"),d.style.backgroundColor=m,e=Combo.New(n("scombo")),f=Combo.New(n("rcombo")),g=[n("next"),n("prev"),n("replaceNext"),n("replacePrev"),n("replaceAll")],h=[n("caseSensitive"),n("wholeWord"),n("regex"),n("inSelection"),n("wrapAround"),n("highlight"),n("persistent")],Object.keys(c).forEach(function(a){return s(a,c[a])}),D(),x()}var a=void 0,b=void 0,c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0;return{ctor:E,show:w,hide:x,position:v,focus:z,notFound:A,overlaps:C,visible:y,get value(){return[e.value,f.value]},set onchange(a){i=a},set onoptchange(a){j=a},set onkeydown(a){k=a},set oninput(a){l=a},set onblur(a){m=a}}}function CMsearch(){"use strict";function f(a,b){return a.line<b.line||a.line===b.line&&a.ch<b.ch}function g(a,b){return a.line>b.line||a.line===b.line&&a.ch>b.ch}function h(a,b){return a.line===b.line&&a.ch===b.ch}function i(){return{line:0,ch:0}}function j(a){for(var b=a.lineCount()-1,c=a.getLine(b).trim().length;b>0&&0===c;)b--,c=a.getLine(b).trim().length;return{line:b,ch:c}}function k(){var b=a.listSelections();if(0===b.length)return null;var c={from:b[0].anchor,to:b[0].head};return g(c.from,c.to)&&(c={from:c.to,to:c.from}),c}function l(a,b,c){var d=new RegExp("(?:^|\\s)"+b+"(?!\\S)","g"),e=arguments.length>2?c:null===a.className.match(d);a.className=a.className.replace(d,""),e&&(a.className+=" "+b)}function m(a,b,c){l(a.getWrapperElement().getElementsByClassName("CodeMirror-cursors")[0],b,c)}function n(a,b,c){var d=Array.from(a.getWrapperElement().getElementsByClassName("CodeMirror-cursor"));d.forEach(function(a){l(a,b,c)})}function o(a){var b=a.replace(/.*\/([gimuy]*)$/,"$1");b===a&&(b="");var c=b?a.replace(new RegExp("^/(.*?)/"+b+"$"),"$1"):a;b.replace("g","");try{return new RegExp(c,b)}catch(a){return null}}function p(){e&&(e.clear(),e=null)}function q(){var a=c.value[0],d=void 0;return void 0===a||null===a?null:(b.regex?d=o(a):(a=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),a&&b.wholeWord&&(a="\\b"+a+"\\b"),d=new RegExp(a)),d&&(d=new RegExp(d.source,b.caseSensitive?"":"i")),d)}function r(){var b=q();d=b&&c.value[0].length>1?new RegExp(b.source,b.flags+"g"):null,d&&(d.lastIndex=0),a.setOption("maxHighlightLength",--a.options.maxHighlightLength+1)}function s(){d=null,a.setOption("maxHighlightLength",--a.options.maxHighlightLength+1)}function t(){var a=k(),c=e?e.find():null;return b.inSelection&&a&&c&&h(c.from,a.from)&&h(c.to,a.to)}function u(){if(!b.inSelection)return{from:i(),to:j(a)};var c=k(),d={from:{line:0,ch:0},to:{line:0,ch:0}};return!c||t()?d:c}function v(){n(a,"redCursor",!0),setTimeout(function(){n(a,"redCursor",!1)},500),b.inSelection||a.setSelection(a.getCursor()),c.visible()?c.notFound():a.focus()}function w(){var d=arguments.length<=0||void 0===arguments[0]||arguments[0],i=q();if(i){var j=u(),k=void 0,l=e?e.find():null;b.inSelection?k=l?d?l.to:l.from:j.from:(k=a.getCursor(),l&&!d&&h(k,l.to)&&(k=l.from));var m=a.getSearchCursor(i,k),n=m.find(!d);return n&&b.inSelection&&(f(m.from(),j.from)||g(m.to(),j.to))&&(n=null),!n&&b.wrapAround&&(k=d?j.from:j.to,m=a.getSearchCursor(i,k),n=m.find(!d),n&&b.inSelection&&(f(m.from(),j.from)||g(m.to(),j.to))&&(n=null)),n?(r(),b.persistent||(c.hide(),a.focus()),a.scrollIntoView({from:m.from(),to:m.to()},20),b.inSelection||a.setSelection(m.from(),m.to()),p(),e=a.markText(m.from(),m.to(),{className:"cm-searchMatch"}),setTimeout(function(){for(var b=a.getWrapperElement().getElementsByClassName("cm-searchMatch")[0];c.overlaps(b.getBoundingClientRect());){var d=a.getScrollInfo().top;if(d<25)break;a.scrollTo(null,d-25)}},0),!0):(v(),!1)}}function x(){var d=arguments.length<=0||void 0===arguments[0]||arguments[0];if(!e)return w(d);var f=q(),g=c.value[1]||"",h=e.find();return f?(b.regex&&!function(){var b=a.getRange(h.from,h.to).match(f);g=g.replace(/\$(\d)/g,function(a,c){return b[c]})}(),a.replaceRange(g,h.from,h.to),p(),e=a.markText(h.from,h.to,{className:"cm-searchMatch"}),void w(d)):void v()}function y(){var d=q(),e=c.value[1];if(!d||!e)return void v();var f=u(),h=0;a.operation(function(){for(var c=a.getSearchCursor(d,f.from);c.findNext()&&(!b.inSelection||!g(c.to(),f.to));)b.regex?!function(){var b=a.getRange(c.from(),c.to()).match(d);c.replace(e.replace(/\$(\d)/g,function(a,c){return b[c]}))}():c.replace(e),h++}),0===h?v():b.persistent||(c.hide(),a.focus()),p()}function z(){var d=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],e=a.getSelection(),f=void 0;!b.inSelection&&e.length>1&&e.length<100&&(f=e,p()),c.show(d,f),r()}function A(a){b.persistent&&!a||(c.hide(),s())}function B(){c.onchange=function(a){r(),"next"===a?w():"prev"===a?w(!1):"replaceNext"===a?x():"replacePrev"===a?x(!1):"replaceAll"===a&&y()},c.onoptchange=function(b){(b=t())&&a.setSelection(a.getCursor()),p(),r()},c.onkeydown=function(b,c){"Escape"===b.key&&(A(!0),a.focus())},c.oninput=function(a,b){b&&r()},c.onblur=function(){A()},a.on("beforeSelectionChange",function(a,c){c.origin&&b.inSelection&&e&&p()}),a.on("change",function(a,b){b.origin&&(c.visible()||s(),p())}),a.on("refresh",function(a){c.position()}),a.on("blur",function(a){m(a,"CodeMirror-cursorsVisible",!0)}),a.on("focus",function(a){m(a,"CodeMirror-cursorsVisible",!1)})}function C(e){a=e,b={caseSensitive:!1,wholeWord:!1,regex:!1,wrapAround:!1,highlight:!0,inSelection:!1,persistent:!0},c=SearchBox.New(a.getWrapperElement(),b),a.addOverlay({token:function(c){if(!d||!b.highlight)return void c.skipToEnd();d.lastIndex=c.pos;var e=d.exec(c.string);return e&&e.index==c.pos?(c.pos+=e[0].length||1,b.inSelection?"inSelectionSearchHighlight":"searchHighlight"):void(e?c.pos=e.index:c.skipToEnd())}}),a.focus(),B()}var a=void 0,b=void 0,c=void 0,d=void 0,e=void 0;return{ctor:C,show:z,hide:A,find:w,replace:x,replaceAll:y}}function initCMsearch(a){"use strict";var b=CMsearch.New(a);a.addKeyMap({"Ctrl-F":function(c){return b.show()},"Ctrl-G":function(c){return b.find()},F3:function(c){return b.find()},"Shift-Ctrl-G":function(c){return b.find(!1)},"Shift-F3":function(c){return b.find(!1)},"Shift-Ctrl-F":function(c){return b.show(!0)},"Ctrl-H":function(c){return b.show(!0)},"Ctrl-F3":function(c){return b.replace()},"Shift-Ctrl-H":function(c){return b.replace()},"Shift-Ctrl-F3":function(c){return b.replace(!1)},"Shift-Ctrl-R":function(c){return b.ReplaceAll()},Esc:function(c){b.hide(!0)}})}
